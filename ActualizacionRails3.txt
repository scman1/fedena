1. Obtener el código fuente

  C:\Sites>git clone https://github.com/scman1/fedena.git
  Cloning into 'fedena'...
  remote: Counting objects: 21434, done.
  remote: Total 21434 (delta 0), reused 0 (delta 0)
  Receiving objects: 100% (21434/21434), 12.01 MiB | 691 KiB/s, done.
  Resolving deltas: 100% (11896/11896), done.

2. Cambiarse al directorio de fedena

  C:\Sites>cd fedena

3. Verificar el estado del proyecto en rama actual

  C:\Sites\fedena>git status
  # On branch master
  nothing to commit (working directory clean)

4. Crear una nueva rama para la actualización a Rails 3.2.14

  C:\Sites\fedena>git checkout -b updateR3
  Switched to a new branch 'updateR3'

5. Verificar las ramas existentes

  C:\Sites\fedena>git branch
    master
  * updateR3

6. Verificar totas las ramas, incluso las remotas

  C:\Sites\fedena>git branch -a
    master
  * updateR3
    remotes/origin/HEAD -> origin/master
    remotes/origin/master

7. Verificar el estado del proyecto en la nueva rama

  C:\Sites\fedena>git status
  # On branch updateR3
  nothing to commit (working directory clean)

8. Crear la nueva aplicación Rails 3 con

  $ rails new .
  Permitimos que se sobreescriba todo, el respaldo del código que funciona en Rails 2 esta en el programa de control de código fuente (git).

9. Restaurar los archivos básicos de la aplicación que fueron sobreescritos

  C:\Sites\fedena>git checkout app/views/layouts/application.html.erb
  C:\Sites\fedena>git checkout app/helpers/application_helper.rb
  C:\Sites\fedena>git checkout app/controllers/application_controller.rb
  C:\Sites\fedena>git checkout db/seeds.rb
  C:\Sites\fedena>git checkout config/locales/en.yml


10. Ahora empezamos restaurando las rutas de la aplicación, la sintaxis ha cambiado pero sigue siendo soportada en rails 3
  
  C:\Sites\fedena>git checkout config/routes.rb

11. Verificamos si es necesario configurar la zona horaria, fedena esta configurado para usar UTC, que es el valor por omisión en rails 3, por lo que no se necesitan cambios.

12. El almacenamiento del identificador de la sesión es la siguiente parte a verificar. En este caso fedena también usa el estilo de rails 3, tampoco se necesita hacer nada.

13. Ahora debemos agergar las gemas que usa fedena al archivo Gemfile.

  gem 'delayed_job_active_record'


14. Problemas con delayed_job. initializer, cambiamos job por worker

15. Agregamos gem 'wicked_pdf' al archivo gemfile

16. Migramos la DB. En este caso tenemos un error, para arrreglarlo removemos rspec.rake  
    Migro manualmente en un directorio temporal
    Problemas:
      1. 20111105052819_add_fields_to_privilege.rb 
         Fallo por mass assignment de los campos :name y :description.
         Para arreglarlo agregamos lo siguiente a la clase

         attr_accessible :name, :description, :school_id 

         Pienso que se requiere mover inicializaciones al archivo de semillas

      2. 20120606050404_remove_grading_type_from_batches.rb. 

         No puede correr en sqlite. 
         Solución eliminamos este campo no deseado desde la creación y tambien esta migración
        
         eliminar: 
           20120421062750_add_grading_type_to_batches.rb
           20120606050404_remove_grading_type_from_batches.rb.

      3 20120704103545_add_cce_indices.rb el indice :fa_groups_subjects se crea dos veces, una en el hash y otra individualmente

        Este problema solo pasaen SQLite porque no acepta duplicar los nombres de indices en diferentes tablas.
        Solución:
        agregamos "1" al nombre del indice y continuamos. debemos movernos a mysql tan pronto como sea posible

      4 20130110095412_add_index_to_student_data.rb este indice:
	    #add_index :student_additional_details, [:student_id,:additional_field_id], :name => "student_data_index"
        ya existe, marcado como comentario

        Este problema solo pasaen SQLite porque no acepta duplicar los nombres de indices en diferentes tablas.
        Solución:
        agregamos "1" al nombre del indice y continuamos. debemos movernos a mysql tan pronto como sea posible

    Hasta aqui todas las migraciones pasan... Pendiente cambiar a MySQL y tratar de nuevo

17. Inicializar la base de datos.
	ejecutamos: rake db:seed
	
	Problema 1. attr_accessible para tablas, igual que el problema descrito anteriormente
	Para arreglarlo agregamos lo siguiente a la clase attr_accessible y la lista de campos que se quieren asignar
	
	Problema 2. cambio de scope a scope
	
	  ActionController::RoutingError (undefined method `scope' for User
	  Este es un problema ocasionado por que 'scope' se cambio a 'scope' para rails 3+ 
	
      Todos los usos de scope se deben editar para evitar este problema
    
	Problema 3. Modelos en subdirectorios (namespaces)
	  https://groups.google.com/forum/#!topic/rubyonrails-talk/c-N8Nq4IAyg   
	  
	Al terminar la base de datos se migra con éxito y contiene las configuraciones iniciales

18.  Tratamos de correr las pruebas
    Primer problema en course model (course.rb)
	
	1. La gema has_and_belongs_to_many_with_deferred_save no esta actualizada para Rails 3

	  Solución:
	  Eliminamos de course.rb
	    has_and_belongs_to_many_with_deferred_save :cce_weightages
	  Y agregamos a course.rb
        has_and_belongs_to_many :cce_weightages
		
    2. Error porque falta la gema in_place_editing, para el controlador de exam_scores.
	  
	  Solución agregamos a gemfile:
	    gem 'in_place_editing'
    3. Error porque falta la gema 'xss_terminate', para el modelo news 
	  
	  Solución agregamos a gemfile:
	  gem 'xss_terminate', '~> 0.22'
	  
	4. Error en por llamada a translate para internacionalización en el modelo student

      Solución editar student.rb:
	  cambiar t() por I18n.t
	  
    5. La gema has_and_belongs_to_many_with_deferred_save no esta actualizada para Rails 3
       
	  Solución:
	  Eliminamos de subject.rb
	    has_and_belongs_to_many_with_deferred_save :fa_groups
	  Y agregamos a subject.rb
        has_and_belongs_to_many :fa_groups
		
    6. La gema 'will_paginate' falta y es referenciada en el ayudante remote_link_renderer.rb.
	   Además el ayudante personaliza la salida de will_paginate y por ello debe derivarse de WillPaginate::ActionView::LinkRenderer

	   Solución agregamos a gemfile:
	    gem 'will_paginate', '~> 3.0'
      y editar remote_link_renderer.rb para que sea sublcalse de: 
        WillPaginate::ActionView::LinkRenderer	  
 	
	7. Problema con la clase de la que se deriva BatchFeeCollectionDiscount, le falta el espacio de nombres
	
      Solución editar batch_fee_collection_discount.rb para agregar el espacio de nombres
	    class Finance::BatchFeeCollectionDiscount < Finance::FeeCollectionDiscount
      y de paso:
     	agregar namespaces para todas las clases de finance 
		agregar I18n a todas las solicitudes de traducción
		cambiar named_scope por scope
	 
	8. Errores de internacionalización en clases de fedena
	
	  Solución:
	    agregar I18n a todas las solicitudes de traducción
		
	
19. Rutas... muchos problemas por la vieja sintaxis de las rutas, arreglarlas todas... long hours
    con esto quedamos igual que en el http://es.asciicasts.com/episodes/225-actualizacion-a-rails-3, la aplicacion "corre", las migraciones tambien se pueden hacer. solo se requiere algunas 

    Empezamos con la ruta de raíz y de ahí vamos activando cada ruta como se requira

20. Problema con: 
    #filter_parameter_logging :password
    en application_controller, comentado pues al parecer no es requerido

21. Problema al cargar las librerias de fedena, modificar el application.rb para que las cargue al iniciar agregando:

    config.autoload_paths += %W(#{config.root}/lib)

22. Problemas con internacionalización. 
    Fedena Usa Translator para internacionalización, el problema es que esta gema funciona solo para rails 2. 
    aparentemente no hay actualizaciones para rails 3+
    Solución usar i18n que provee rails.
    Para esto debemos crear un scope e incluir las rutas que deben ser traducidas en dicho scope.

    1. todos los archivos de locales dan problemas al cargarse porque tiene la forma:

    order: [ :year, :month, :day ]

       Para que puedan ser leidos correctamente se deben cambiar a 

    order:
      - :day
      - :month
      - :year
	

    2. en los lugares donde se usa solo "t" se debe cambiar a "I18n.t"
 
    3. Al arrancar la aplicacion se tiene un mensaje de error por que la gema de i18n (i18n (~> 0.6, >= 0.6.4)) 
	   tiene un bug. 
	*************************************************************************************
	* [deprecated] I18n.enforce_available_locales will default to true in the future.   *
    * If you really want to skip validation of your locale you can set I18n.enforce_av  *
    * ailable_locales = false to avoid this message.                                    *
    *************************************************************************************
    Por el momento se puede dejar así y esperar a la actualización de la gema (cuando movamos a rails mayor que 3.2.14)
	
    Adicionales
	
	A1. Agregar paperclip a gemfile
	A2. Arreglar las rutas a la raíz
	A3. La aplicación carga y muestra la pantalla de login
    A4. Al cambiar la incialización se actualiza el lenguaje automaticámente, i18n funciona	20

23. Problemas en la primera ejecución (visibles desde el navegador)
	
	2. Error en clase configuration
	  undefined method `find_all_by_config_key' for ActiveSupport::Configurable::Configuration:Class
	  app/controllers/user_controller.rb:232:in `login'
	  
	  Este error viene de como se inicializa la clase 'Configuration'
	  

24. Arreglar rutas y terminar de agregar plugins a Gemfile
    
25. Arreglar estilos

26. Arreglar Javascript




